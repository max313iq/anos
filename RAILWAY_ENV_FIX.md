# Fix Railway SSO Redirect Issue

## Problem
Railway is redirecting to Gitpod URL after login because `PROXY_BASE_URL` environment variable is set to the old Gitpod URL.

## Solution

### Step 1: Update Railway Environment Variables

Go to your Railway project and update these environment variables:

```bash
# REMOVE or UPDATE this variable:
PROXY_BASE_URL=https://anos-production.up.railway.app

# Or simply DELETE PROXY_BASE_URL to use auto-detection
```

### Step 2: Verify Other Environment Variables

Make sure these are set correctly:

```bash
# Database (internal URL for better performance)
DATABASE_URL=postgresql://postgres:ewJimjnmajcUjpxXDnjEUuOJoWEqiliE@postgres.railway.internal:5432/railway

# Redis (if you added it)
REDIS_HOST=redis.railway.internal
REDIS_PORT=6379
REDIS_PASSWORD=<auto-generated>

# LiteLLM Mode
LITELLM_MODE=PRODUCTION

# DO NOT SET PROXY_BASE_URL - let it auto-detect
# PROXY_BASE_URL should be empty or match your Railway domain
```

### Step 3: Redeploy

After updating environment variables:
1. Railway will automatically redeploy
2. Or manually trigger: **Deploy** â†’ **Redeploy**

### Step 4: Test

Visit: `https://anos-production.up.railway.app/ui/`

The login should now redirect correctly to Railway, not Gitpod.

## How It Works

When `PROXY_BASE_URL` is NOT set:
- The app uses `request.base_url` (auto-detects the current domain)
- Works on Railway, Gitpod, localhost automatically

When `PROXY_BASE_URL` IS set:
- The app uses that URL for all redirects
- Must match the deployment domain exactly

## Quick Fix via Railway CLI

```bash
# Remove PROXY_BASE_URL
railway variables delete PROXY_BASE_URL

# Or update it
railway variables set PROXY_BASE_URL=https://anos-production.up.railway.app
```

## Alternative: Update in Railway Dashboard

1. Go to Railway project
2. Click on your service
3. Go to **Variables** tab
4. Find `PROXY_BASE_URL`
5. Either:
   - **Delete it** (recommended - auto-detection)
   - **Update it** to `https://anos-production.up.railway.app`
6. Save and redeploy

---

**After this fix, all SSO redirects will work correctly on Railway!** ðŸŽ‰
